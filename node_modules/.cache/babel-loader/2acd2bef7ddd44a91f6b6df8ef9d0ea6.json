{"ast":null,"code":"var _jsxFileName = \"/Users/huanwen/Work/Cook/cook-frontend/src/components/Distribution/index.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport BigNumber from 'bignumber.js';\nimport { getDistributionVestingAmount, getDistributionVestedAmount, getDistributionAvalibleAmount, getDistributionStartTimestamp, getTodayNumber, getTokenAllowance, getTokenBalance, getStakeLockupDuration, getRewardPerBlock, getTotalStaked, getPoolBalanceOfStaked } from '../../utils/infura';\nimport { COOK, UNI, WETH } from \"../../constants/tokens\";\nimport { CookDistribution, POOLS, COOK_POOLS } from \"../../constants/contracts\";\nimport { toTokenUnitsBN } from '../../utils/number';\nimport WithdrawPageHeader from \"./Header\";\nimport Withdraw from \"./Withdraw\";\nimport LinearText from \"../common/LinearText\";\nimport DistributionZap from \"./DistributionZap\";\nimport ZapCook from \"./ZapCook\";\nimport { Row, Col } from 'react-grid-system';\nimport colors from '../../constants/colors';\nimport { useViewport } from '@aragon/ui';\n\nfunction Distribution({\n  user\n}) {\n  const {\n    override\n  } = useParams();\n\n  if (override) {\n    user = override;\n  }\n\n  const {\n    below\n  } = useViewport();\n  const [userWETHBalance, setUserWETHBalance] = useState(new BigNumber(0));\n  const [userWETHAllowance, setUserWETHAllowance] = useState(new BigNumber(0));\n  const [pairBalanceCOOK, setPairBalanceCOOK] = useState(new BigNumber(0));\n  const [pairBalanceWETH, setPairBalanceWETH] = useState(new BigNumber(0));\n  const [userVestingBalance, setUserVestingBalance] = useState(new BigNumber(0));\n  const [userVestedBalance, setUserVestedBalance] = useState(new BigNumber(0));\n  const [userAvalibleBalance, setUserAvalibleBalance] = useState(new BigNumber(0));\n  const [startDay, setStartDay] = useState(new BigNumber(0));\n  const [today, setToday] = useState(new BigNumber(0));\n  const [managedPools, setManagedPools] = useState([]);\n  const [cookPools, setCookPools] = useState([]); //Update User balances\n\n  useEffect(() => {\n    if (user === '') {\n      setUserVestingBalance(new BigNumber(0));\n      setUserVestedBalance(new BigNumber(0));\n      setUserAvalibleBalance(new BigNumber(0));\n      setPairBalanceCOOK(new BigNumber(0));\n      setPairBalanceWETH(new BigNumber(0));\n      setUserWETHBalance(new BigNumber(0));\n      setUserWETHAllowance(new BigNumber(0));\n      setStartDay(new BigNumber(0));\n      setToday(new BigNumber(0));\n      setManagedPools([]);\n      setCookPools([]);\n      return;\n    }\n\n    let isCancelled = false;\n\n    async function updateUserInfo() {\n      const [vestingBalance, vestedBalance, avalibleBalance, startTimeStamp, tDay, pairBalanceCOOKStr, pairBalanceWETHStr, wethBalance, wethAllowance] = await Promise.all([getDistributionVestingAmount(CookDistribution, user), getDistributionVestedAmount(CookDistribution, user), getDistributionAvalibleAmount(CookDistribution, user), getDistributionStartTimestamp(CookDistribution), getTodayNumber(CookDistribution), getTokenBalance(COOK.addr, UNI.addr), getTokenBalance(WETH.addr, UNI.addr), getTokenBalance(WETH.addr, user), getTokenAllowance(WETH.addr, user, CookDistribution)]);\n      console.log('wethAllowance', wethAllowance);\n      const userVestingBalance = toTokenUnitsBN(vestingBalance, COOK.decimals);\n      const userVestedBalance = toTokenUnitsBN(vestedBalance, COOK.decimals);\n      const userAvalibleBalance = toTokenUnitsBN(avalibleBalance, COOK.decimals);\n      const startDay = new BigNumber(startTimeStamp).div(86400).decimalPlaces(0, 1);\n      const todayNumber = new BigNumber(tDay);\n      const pairCOOKBalance = toTokenUnitsBN(pairBalanceCOOKStr, COOK.decimals);\n      const pairWETHBalance = toTokenUnitsBN(pairBalanceWETHStr, WETH.decimals);\n      const userWETHBalance = toTokenUnitsBN(wethBalance, WETH.decimals);\n      const poolList = await Promise.all(POOLS.map(async pool => {\n        const [lockedup, reward, staked, totalStaked] = await Promise.all([getStakeLockupDuration(pool.address), getRewardPerBlock(pool.address), getTotalStaked(pool.address), getPoolBalanceOfStaked(pool.address, user)]);\n        const totalStakedBalance = toTokenUnitsBN(totalStaked, UNI.decimals);\n        const userTotalStakedBalance = toTokenUnitsBN(staked, UNI.decimals);\n        const poolRewardPerBlock = toTokenUnitsBN(reward, COOK.decimals);\n        return {\n          pool: pool.address,\n          lockedUp: lockedup,\n          reward: poolRewardPerBlock,\n          staked: userTotalStakedBalance,\n          totalStaked: totalStakedBalance,\n          name: pool.name,\n          address: pool.address,\n          lockedUpPeriod: lockedup,\n          rewardPerBlock: poolRewardPerBlock\n        };\n      }));\n      const cookPoolList = await Promise.all(COOK_POOLS.map(async pool => {\n        const [lockedup, reward, staked, totalStaked] = await Promise.all([getStakeLockupDuration(pool.address), getRewardPerBlock(pool.address), getTotalStaked(pool.address), getPoolBalanceOfStaked(pool.address, user)]);\n        const totalStakedBalance = toTokenUnitsBN(totalStaked, COOK.decimals);\n        const userTotalStakedBalance = toTokenUnitsBN(staked, COOK.decimals);\n        const poolRewardPerBlock = toTokenUnitsBN(reward, COOK.decimals);\n        return {\n          pool: pool.address,\n          lockedUp: lockedup,\n          reward: poolRewardPerBlock,\n          staked: userTotalStakedBalance,\n          totalStaked: totalStakedBalance,\n          name: pool.name,\n          address: pool.address,\n          lockedUpPeriod: lockedup,\n          rewardPerBlock: poolRewardPerBlock\n        };\n      }));\n\n      if (!isCancelled) {\n        setUserVestingBalance(new BigNumber(userVestingBalance));\n        setUserVestedBalance(new BigNumber(userVestedBalance));\n        setUserAvalibleBalance(new BigNumber(userAvalibleBalance));\n        setStartDay(new BigNumber(startDay));\n        setToday(new BigNumber(todayNumber));\n        setPairBalanceCOOK(new BigNumber(pairCOOKBalance));\n        setPairBalanceWETH(new BigNumber(pairWETHBalance));\n        setUserWETHBalance(new BigNumber(userWETHBalance));\n        setManagedPools(poolList);\n        setCookPools(cookPoolList); // console.log(wethAllowance);\n\n        setUserWETHAllowance(new BigNumber(wethAllowance));\n      }\n    }\n\n    updateUserInfo();\n    const id = setInterval(updateUserInfo, 15000); // eslint-disable-next-line consistent-return\n\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      padding: '2%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 7\n    }\n  }, \"Distribution\"), /*#__PURE__*/React.createElement(LinearText, {\n    text: \"Manage Cook balance for presale parties\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: 30,\n      display: 'flex',\n      alignItems: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      padding: '40px 30px',\n      backgroundColor: colors.secondary,\n      width: \"100%\",\n      margin: \"10pt auto\",\n      textAlign: \"center\",\n      borderRadius: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(WithdrawPageHeader, {\n    accountVestingBalance: userVestingBalance,\n    accountAvalibleBalance: userAvalibleBalance,\n    accountVestedBalance: userVestedBalance,\n    todayNumber: today,\n    startDayNumber: startDay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(Row, {\n    style: {\n      marginTop: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    xs: 12,\n    md: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Withdraw, {\n    user: user,\n    vestingAmount: userVestingBalance,\n    availableAmount: userAvalibleBalance,\n    records: [],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    xs: 12,\n    md: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(DistributionZap, {\n    user: user,\n    pools: managedPools,\n    cookAvailable: userAvalibleBalance,\n    wethBalance: userWETHBalance,\n    wethAllowance: userWETHAllowance,\n    pairBalanceWETH: pairBalanceWETH,\n    pairBalanceCOOK: pairBalanceCOOK,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    xs: 12,\n    md: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ZapCook, {\n    user: user,\n    pools: cookPools,\n    cookAvailable: userAvalibleBalance,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 11\n    }\n  }))));\n}\n\nexport default Distribution;","map":{"version":3,"sources":["/Users/huanwen/Work/Cook/cook-frontend/src/components/Distribution/index.tsx"],"names":["React","useState","useEffect","useParams","BigNumber","getDistributionVestingAmount","getDistributionVestedAmount","getDistributionAvalibleAmount","getDistributionStartTimestamp","getTodayNumber","getTokenAllowance","getTokenBalance","getStakeLockupDuration","getRewardPerBlock","getTotalStaked","getPoolBalanceOfStaked","COOK","UNI","WETH","CookDistribution","POOLS","COOK_POOLS","toTokenUnitsBN","WithdrawPageHeader","Withdraw","LinearText","DistributionZap","ZapCook","Row","Col","colors","useViewport","Distribution","user","override","below","userWETHBalance","setUserWETHBalance","userWETHAllowance","setUserWETHAllowance","pairBalanceCOOK","setPairBalanceCOOK","pairBalanceWETH","setPairBalanceWETH","userVestingBalance","setUserVestingBalance","userVestedBalance","setUserVestedBalance","userAvalibleBalance","setUserAvalibleBalance","startDay","setStartDay","today","setToday","managedPools","setManagedPools","cookPools","setCookPools","isCancelled","updateUserInfo","vestingBalance","vestedBalance","avalibleBalance","startTimeStamp","tDay","pairBalanceCOOKStr","pairBalanceWETHStr","wethBalance","wethAllowance","Promise","all","addr","console","log","decimals","div","decimalPlaces","todayNumber","pairCOOKBalance","pairWETHBalance","poolList","map","pool","lockedup","reward","staked","totalStaked","address","totalStakedBalance","userTotalStakedBalance","poolRewardPerBlock","lockedUp","name","lockedUpPeriod","rewardPerBlock","cookPoolList","id","setInterval","clearInterval","padding","marginTop","display","alignItems","backgroundColor","secondary","width","margin","textAlign","borderRadius"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\n\nimport BigNumber from 'bignumber.js';\nimport {\n  getDistributionVestingAmount,\n  getDistributionVestedAmount,\n  getDistributionAvalibleAmount,\n  getDistributionStartTimestamp,\n  getTodayNumber,\n  getTokenAllowance,\n  getTokenBalance,\n  getStakeLockupDuration,\n  getRewardPerBlock,\n  getTotalStaked,\n  getPoolBalanceOfStaked\n} from '../../utils/infura';\nimport { COOK, UNI, WETH } from \"../../constants/tokens\";\nimport { CookDistribution, POOLS, COOK_POOLS } from \"../../constants/contracts\";\nimport { toTokenUnitsBN } from '../../utils/number';\nimport WithdrawPageHeader from \"./Header\";\nimport Withdraw from \"./Withdraw\";\nimport LinearText from \"../common/LinearText\";\nimport DistributionZap from \"./DistributionZap\";\nimport ZapCook from \"./ZapCook\";\nimport { Row, Col } from 'react-grid-system';\nimport colors from '../../constants/colors';\nimport {\n  useViewport\n} from '@aragon/ui';\n\nfunction Distribution({ user }: { user: string }) {\n  const { override } = useParams();\n  if (override) {\n    user = override;\n  }\n  const { below } = useViewport()\n  const [userWETHBalance, setUserWETHBalance] = useState(new BigNumber(0));\n  const [userWETHAllowance, setUserWETHAllowance] = useState(new BigNumber(0));\n\n  const [pairBalanceCOOK, setPairBalanceCOOK] = useState(new BigNumber(0));\n  const [pairBalanceWETH, setPairBalanceWETH] = useState(new BigNumber(0));\n\n\n  const [userVestingBalance, setUserVestingBalance] = useState(new BigNumber(0));\n  const [userVestedBalance, setUserVestedBalance] = useState(new BigNumber(0));\n  const [userAvalibleBalance, setUserAvalibleBalance] = useState(new BigNumber(0));\n\n  const [startDay, setStartDay] = useState(new BigNumber(0));\n  const [today, setToday] = useState(new BigNumber(0));\n  const [managedPools, setManagedPools] = useState([] as any);\n  const [cookPools, setCookPools] = useState([] as any);\n\n  //Update User balances\n  useEffect(() => {\n    if (user === '') {\n      setUserVestingBalance(new BigNumber(0));\n      setUserVestedBalance(new BigNumber(0));\n      setUserAvalibleBalance(new BigNumber(0));\n      setPairBalanceCOOK(new BigNumber(0));\n      setPairBalanceWETH(new BigNumber(0));\n      setUserWETHBalance(new BigNumber(0));\n      setUserWETHAllowance(new BigNumber(0));\n      setStartDay(new BigNumber(0));\n      setToday(new BigNumber(0));\n      setManagedPools([]);\n      setCookPools([]);\n      return;\n    }\n    let isCancelled = false;\n\n    async function updateUserInfo() {\n      const [\n        vestingBalance,\n        vestedBalance,\n        avalibleBalance,\n        startTimeStamp,\n        tDay,\n        pairBalanceCOOKStr,\n        pairBalanceWETHStr,\n        wethBalance,\n        wethAllowance\n      ] = await Promise.all([\n        getDistributionVestingAmount(CookDistribution, user),\n        getDistributionVestedAmount(CookDistribution, user),\n        getDistributionAvalibleAmount(CookDistribution, user),\n        getDistributionStartTimestamp(CookDistribution),\n        getTodayNumber(CookDistribution),\n        getTokenBalance(COOK.addr, UNI.addr),\n        getTokenBalance(WETH.addr, UNI.addr),\n        getTokenBalance(WETH.addr, user),\n        getTokenAllowance(WETH.addr, user, CookDistribution)\n      ]);\n      console.log('wethAllowance', wethAllowance);\n      const userVestingBalance = toTokenUnitsBN(vestingBalance, COOK.decimals);\n      const userVestedBalance = toTokenUnitsBN(vestedBalance, COOK.decimals);\n      const userAvalibleBalance = toTokenUnitsBN(avalibleBalance, COOK.decimals);\n      const startDay = new BigNumber(startTimeStamp).div(86400).decimalPlaces(0, 1);\n      const todayNumber = new BigNumber(tDay);\n\n      const pairCOOKBalance = toTokenUnitsBN(pairBalanceCOOKStr, COOK.decimals);\n      const pairWETHBalance = toTokenUnitsBN(pairBalanceWETHStr, WETH.decimals);\n      const userWETHBalance = toTokenUnitsBN(wethBalance, WETH.decimals);\n\n\n      const poolList = await Promise.all(POOLS.map(async (pool) => {\n        const [lockedup, reward, staked, totalStaked] =\n          await Promise.all([\n            getStakeLockupDuration(pool.address),\n            getRewardPerBlock(pool.address),\n            getTotalStaked(pool.address),\n            getPoolBalanceOfStaked(pool.address, user)\n          ])\n\n        const totalStakedBalance = toTokenUnitsBN(totalStaked, UNI.decimals);\n        const userTotalStakedBalance = toTokenUnitsBN(staked, UNI.decimals);\n        const poolRewardPerBlock = toTokenUnitsBN(reward, COOK.decimals);\n\n\n        return ({\n          pool: pool.address, lockedUp: lockedup, reward: poolRewardPerBlock, staked: userTotalStakedBalance, totalStaked: totalStakedBalance,\n          name: pool.name,\n          address: pool.address,\n          lockedUpPeriod: lockedup,\n          rewardPerBlock: poolRewardPerBlock\n        })\n      }))\n\n      const cookPoolList = await Promise.all(COOK_POOLS.map(async (pool) => {\n        const [lockedup, reward, staked, totalStaked] =\n          await Promise.all([\n            getStakeLockupDuration(pool.address),\n            getRewardPerBlock(pool.address),\n            getTotalStaked(pool.address),\n            getPoolBalanceOfStaked(pool.address, user)\n          ])\n\n        const totalStakedBalance = toTokenUnitsBN(totalStaked, COOK.decimals);\n        const userTotalStakedBalance = toTokenUnitsBN(staked, COOK.decimals);\n        const poolRewardPerBlock = toTokenUnitsBN(reward, COOK.decimals);\n\n        return ({\n          pool: pool.address, lockedUp: lockedup, reward: poolRewardPerBlock, staked: userTotalStakedBalance, totalStaked: totalStakedBalance,\n          name: pool.name,\n          address: pool.address,\n          lockedUpPeriod: lockedup,\n          rewardPerBlock: poolRewardPerBlock\n        })\n      }))\n\n      if (!isCancelled) {\n        setUserVestingBalance(new BigNumber(userVestingBalance));\n        setUserVestedBalance(new BigNumber(userVestedBalance));\n        setUserAvalibleBalance(new BigNumber(userAvalibleBalance));\n        setStartDay(new BigNumber(startDay));\n        setToday(new BigNumber(todayNumber));\n\n        setPairBalanceCOOK(new BigNumber(pairCOOKBalance));\n        setPairBalanceWETH(new BigNumber(pairWETHBalance));\n        setUserWETHBalance(new BigNumber(userWETHBalance));\n        setManagedPools(poolList)\n        setCookPools(cookPoolList);\n        // console.log(wethAllowance);\n        setUserWETHAllowance(new BigNumber(wethAllowance));\n      }\n    }\n    updateUserInfo();\n    const id = setInterval(updateUserInfo, 15000);\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n\n  return (\n    <div style={{ padding: '2%' }}>\n      <div className=\"title\">Distribution</div>\n      <LinearText text={\"Manage Cook balance for presale parties\"} />\n      <div style={{ marginTop: 30, display: 'flex', alignItems: 'center' }}>\n\n        <div style={{\n          padding: '40px 30px',\n          backgroundColor: colors.secondary,\n          width: \"100%\", margin: \"10pt auto\", textAlign: \"center\", borderRadius: 20\n        }}>\n          <WithdrawPageHeader\n            accountVestingBalance={userVestingBalance}\n            accountAvalibleBalance={userAvalibleBalance}\n            accountVestedBalance={userVestedBalance}\n            todayNumber={today}\n            startDayNumber={startDay}\n          />\n\n        </div>\n\n      </div>\n      <Row style={{ marginTop: 10 }}>\n        <Col xs={12} md={4}>\n          <Withdraw\n            user={user}\n            vestingAmount={userVestingBalance}\n            availableAmount={userAvalibleBalance}\n            records={[]}\n          />\n        </Col>\n        <Col xs={12} md={4} >\n          <DistributionZap\n            user={user}\n            pools={managedPools}\n            cookAvailable={userAvalibleBalance}\n            wethBalance={userWETHBalance}\n            wethAllowance={userWETHAllowance}\n            pairBalanceWETH={pairBalanceWETH}\n            pairBalanceCOOK={pairBalanceCOOK}\n          />\n        </Col>\n        <Col xs={12} md={4} >\n          <ZapCook\n            user={user}\n            pools={cookPools}\n            cookAvailable={userAvalibleBalance}\n          />\n        </Col>\n      </Row>\n    </div>\n  );\n}\n\nexport default Distribution;\n"]},"metadata":{},"sourceType":"module"}