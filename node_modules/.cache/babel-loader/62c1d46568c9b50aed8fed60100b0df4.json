{"ast":null,"code":"import _regeneratorRuntime from\"/Users/huanwen/Work/Cook/cook-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/huanwen/Work/Cook/cook-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/huanwen/Work/Cook/cook-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{useParams}from'react-router-dom';import{getStakeLockupDuration,getRewardPerBlock,getTotalStaked}from'../../utils/infura';import{useViewport,Modal,Button}from'@aragon/ui';import{POOLS}from\"../../constants/contracts\";import{toTokenUnitsBN}from'../../utils/number';import{COOK,UNI}from\"../../constants/tokens\";import Pool from\"../Pool\";import BigNumber from'bignumber.js';import ListTable from\"./ListTable\";import{Row,Col}from'react-grid-system';function PoolList(_ref){var user=_ref.user;var _useParams=useParams(),override=_useParams.override;if(override){user=override;}var _useViewport=useViewport(),below=_useViewport.below,above=_useViewport.above;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),poolList=_useState2[0],setPoolList=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),selectedPool=_useState4[0],_setSelectedPool=_useState4[1];var _useState5=useState(new BigNumber(0)),_useState6=_slicedToArray(_useState5,2),totalStaked=_useState6[0],setTotalStaked=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),opened=_useState8[0],setOpened=_useState8[1];useEffect(function(){var isCancelled=false;// setPoolList([{name:\"4 UNI-V2 (WETH/COOK)\", address:\"0xf4B146FbA71F41E0592668ffbF264F1D186b2Ca8\",lockedUpPeriod:\"90 days\",rewardPerBlock:\"300\"}]);\nfunction updatePoolInfo(){return _updatePoolInfo.apply(this,arguments);}function _updatePoolInfo(){_updatePoolInfo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var poolList,totalStakedBalance,totalStaked;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return Promise.all(POOLS.map(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(pool){var _yield$Promise$all,_yield$Promise$all2,lockedup,reward,poolRewardPerBlock;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Promise.all([getStakeLockupDuration(pool.address),getRewardPerBlock(pool.address)]);case 2:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);lockedup=_yield$Promise$all2[0];reward=_yield$Promise$all2[1];poolRewardPerBlock=toTokenUnitsBN(reward,COOK.decimals);return _context.abrupt(\"return\",{name:pool.name,address:pool.address,lockedUpPeriod:lockedup,rewardPerBlock:poolRewardPerBlock});case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}()));case 2:poolList=_context3.sent;_context3.next=5;return POOLS.reduce(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(sum,pool){var staked;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getTotalStaked(pool.address);case 2:staked=_context2.sent;_context2.next=5;return sum;case 5:return _context2.abrupt(\"return\",_context2.sent.plus(staked));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2,_x3){return _ref3.apply(this,arguments);};}(),Promise.resolve(new BigNumber(0)));case 5:totalStakedBalance=_context3.sent;totalStaked=toTokenUnitsBN(totalStakedBalance,UNI.decimals);if(!isCancelled){setPoolList(poolList);setTotalStaked(totalStaked);}case 8:case\"end\":return _context3.stop();}}},_callee3);}));return _updatePoolInfo.apply(this,arguments);}updatePoolInfo();var id=setInterval(updatePoolInfo,15000);// eslint-disable-next-line consistent-return\nreturn function(){isCancelled=true;clearInterval(id);};},[user]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{style:{textAlign:\"center\"}},/*#__PURE__*/React.createElement(\"div\",{style:{fontSize:40}},\"Total Staked\"),/*#__PURE__*/React.createElement(\"div\",{style:{marginBottom:8,fontSize:40,paddingRight:10}},totalStaked.toString(),\" UNI-V2\")),/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{sm:12,lg:5},/*#__PURE__*/React.createElement(ListTable,{pools:poolList,selectedPool:selectedPool,setSelectedPool:function setSelectedPool(selected){_setSelectedPool(selected);setOpened(true);},detailMode:true})),/*#__PURE__*/React.createElement(Col,{sm:12,lg:7},selectedPool===''?'':/*#__PURE__*/React.createElement(React.Fragment,null,above('medium')&&/*#__PURE__*/React.createElement(Pool,{user:user,poolAddress:selectedPool,pools:poolList}),below('medium')&&/*#__PURE__*/React.createElement(Modal,{closeButton:false,visible:opened,onClose:function onClose(){}},/*#__PURE__*/React.createElement(Pool,{user:user,poolAddress:selectedPool,pools:poolList}),/*#__PURE__*/React.createElement(Button,{wide:true,style:{marginTop:20},label:\"Close\",onClick:function onClick(){setOpened(false);},disabled:false}))))));}export default PoolList;","map":{"version":3,"sources":["/Users/huanwen/Work/Cook/cook-frontend/src/components/PoolList/index.tsx"],"names":["React","useState","useEffect","useParams","getStakeLockupDuration","getRewardPerBlock","getTotalStaked","useViewport","Modal","Button","POOLS","toTokenUnitsBN","COOK","UNI","Pool","BigNumber","ListTable","Row","Col","PoolList","user","override","below","above","poolList","setPoolList","selectedPool","setSelectedPool","totalStaked","setTotalStaked","opened","setOpened","isCancelled","updatePoolInfo","Promise","all","map","pool","address","lockedup","reward","poolRewardPerBlock","decimals","name","lockedUpPeriod","rewardPerBlock","reduce","sum","staked","plus","resolve","totalStakedBalance","id","setInterval","clearInterval","textAlign","fontSize","marginBottom","paddingRight","toString","selected","marginTop"],"mappings":"odAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,OACEC,sBADF,CAEEC,iBAFF,CAGEC,cAHF,KAIO,oBAJP,CAKA,OACEC,WADF,CACeC,KADf,CACsBC,MADtB,KAEO,YAFP,CAGA,OAASC,KAAT,KAAsB,2BAAtB,CACA,OAASC,cAAT,KAA+B,oBAA/B,CACA,OAASC,IAAT,CAAcC,GAAd,KAAyB,wBAAzB,CACA,MAAOC,CAAAA,IAAP,KAAiB,SAAjB,CACA,MAAOC,CAAAA,SAAP,KAAsB,cAAtB,CACA,MAAOC,CAAAA,SAAP,KAAsB,aAAtB,CACA,OAASC,GAAT,CAAcC,GAAd,KAAyB,mBAAzB,CAEA,QAASC,CAAAA,QAAT,MAA4C,IAAxBC,CAAAA,IAAwB,MAAxBA,IAAwB,gBACrBjB,SAAS,EADY,CAClCkB,QADkC,YAClCA,QADkC,CAE1C,GAAIA,QAAJ,CAAc,CACZD,IAAI,CAAGC,QAAP,CACD,CAJyC,iBAKjBd,WAAW,EALM,CAKlCe,KALkC,cAKlCA,KALkC,CAK3BC,KAL2B,cAK3BA,KAL2B,eAMVtB,QAAQ,CAAC,EAAD,CANE,wCAMnCuB,QANmC,eAMzBC,WANyB,8BAOFxB,QAAQ,CAAC,EAAD,CAPN,yCAOnCyB,YAPmC,eAOrBC,gBAPqB,8BAQJ1B,QAAQ,CAAC,GAAIc,CAAAA,SAAJ,CAAc,CAAd,CAAD,CARJ,yCAQnCa,WARmC,eAQtBC,cARsB,8BASd5B,QAAQ,CAAC,KAAD,CATM,yCASnC6B,MATmC,eAS3BC,SAT2B,eAW1C7B,SAAS,CAAC,UAAM,CACd,GAAI8B,CAAAA,WAAW,CAAG,KAAlB,CACA;AAFc,QAGCC,CAAAA,cAHD,oJAGd,2MACyBC,CAAAA,OAAO,CAACC,GAAR,CAAYzB,KAAK,CAAC0B,GAAN,2FAAW,iBAAOC,IAAP,sNAEtCH,CAAAA,OAAO,CAACC,GAAR,CAAY,CACd/B,sBAAsB,CAACiC,IAAI,CAACC,OAAN,CADR,CAEdjC,iBAAiB,CAACgC,IAAI,CAACC,OAAN,CAFH,CAAZ,CAFsC,kGACrCC,QADqC,wBAC5BC,MAD4B,wBAMtCC,kBANsC,CAMjB9B,cAAc,CAAC6B,MAAD,CAAS5B,IAAI,CAAC8B,QAAd,CANG,iCAOrC,CACLC,IAAI,CAAEN,IAAI,CAACM,IADN,CAELL,OAAO,CAAED,IAAI,CAACC,OAFT,CAGLM,cAAc,CAAEL,QAHX,CAILM,cAAc,CAAEJ,kBAJX,CAPqC,wDAAX,gEAAZ,CADzB,QACQjB,QADR,uCAgBmCd,CAAAA,KAAK,CAACoC,MAAN,2FAAa,kBAAOC,GAAP,CAAYV,IAAZ,wJACvB/B,CAAAA,cAAc,CAAC+B,IAAI,CAACC,OAAN,CADS,QACtCU,MADsC,uCAE9BD,CAAAA,GAF8B,wDAEzBE,IAFyB,CAEpBD,MAFoB,2DAAb,qEAG9Bd,OAAO,CAACgB,OAAR,CAAgB,GAAInC,CAAAA,SAAJ,CAAc,CAAd,CAAhB,CAH8B,CAhBnC,QAgBQoC,kBAhBR,gBAqBQvB,WArBR,CAqBsBjB,cAAc,CAACwC,kBAAD,CAAqBtC,GAAG,CAAC6B,QAAzB,CArBpC,CAuBE,GAAI,CAACV,WAAL,CAAkB,CAChBP,WAAW,CAACD,QAAD,CAAX,CACAK,cAAc,CAACD,WAAD,CAAd,CACD,CA1BH,wDAHc,iDA+BdK,cAAc,GAEd,GAAMmB,CAAAA,EAAE,CAAGC,WAAW,CAACpB,cAAD,CAAiB,KAAjB,CAAtB,CAEA;AACA,MAAO,WAAM,CACXD,WAAW,CAAG,IAAd,CACAsB,aAAa,CAACF,EAAD,CAAb,CACD,CAHD,CAID,CAxCQ,CAwCN,CAAChC,IAAD,CAxCM,CAAT,CAyCA,mBACE,qDACE,2BAAK,KAAK,CAAE,CAACmC,SAAS,CAAC,QAAX,CAAZ,eACE,2BAAK,KAAK,CAAE,CAACC,QAAQ,CAAC,EAAV,CAAZ,iBADF,cAEE,2BAAK,KAAK,CAAE,CAAEC,YAAY,CAAC,CAAf,CAAiBD,QAAQ,CAAC,EAA1B,CAA8BE,YAAY,CAAC,EAA3C,CAAZ,EAA6D9B,WAAW,CAAC+B,QAAZ,EAA7D,WAFF,CADF,cAKE,oBAAC,GAAD,mBACE,oBAAC,GAAD,EAAK,EAAE,CAAE,EAAT,CAAa,EAAE,CAAE,CAAjB,eACE,oBAAC,SAAD,EAAW,KAAK,CAAEnC,QAAlB,CAA4B,YAAY,CAAEE,YAA1C,CAAwD,eAAe,CAAE,yBAACkC,QAAD,CAAY,CACnFjC,gBAAe,CAACiC,QAAD,CAAf,CACA7B,SAAS,CAAC,IAAD,CAAT,CACD,CAHD,CAIE,UAAU,CAAE,IAJd,EADF,CADF,cASI,oBAAC,GAAD,EAAK,EAAE,CAAE,EAAT,CAAa,EAAE,CAAE,CAAjB,EACCL,YAAY,GAAK,EAAjB,CAAsB,EAAtB,cACC,wCACCH,KAAK,CAAC,QAAD,CAAL,eAAmB,oBAAC,IAAD,EAAM,IAAI,CAAEH,IAAZ,CAAkB,WAAW,CAAEM,YAA/B,CAA6C,KAAK,CAAEF,QAApD,EADpB,CAECF,KAAK,CAAC,QAAD,CAAL,eAAmB,oBAAC,KAAD,EAAO,WAAW,CAAE,KAApB,CAA2B,OAAO,CAAEQ,MAApC,CAA4C,OAAO,CAAE,kBAAI,CAC5E,CADmB,eACjB,oBAAC,IAAD,EAAM,IAAI,CAAEV,IAAZ,CAAkB,WAAW,CAAEM,YAA/B,CAA6C,KAAK,CAAEF,QAApD,EADiB,cAEpB,oBAAC,MAAD,EACE,IAAI,KADN,CAEE,KAAK,CAAE,CAACqC,SAAS,CAAC,EAAX,CAFT,CAGE,KAAK,CAAE,OAHT,CAIE,OAAO,CAAE,kBAAM,CACb9B,SAAS,CAAC,KAAD,CAAT,CACD,CANH,CAOE,QAAQ,CAAE,KAPZ,EAFoB,CAFpB,CAFF,CATJ,CALF,CADF,CAqCD,CAED,cAAeZ,CAAAA,QAAf","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport {\n  getStakeLockupDuration,\n  getRewardPerBlock,\n  getTotalStaked\n} from '../../utils/infura';\nimport {\n  useViewport, Modal, Button\n} from '@aragon/ui';\nimport { POOLS } from \"../../constants/contracts\";\nimport { toTokenUnitsBN } from '../../utils/number';\nimport { COOK,UNI } from \"../../constants/tokens\";\nimport Pool from \"../Pool\";\nimport BigNumber from 'bignumber.js';\nimport ListTable from \"./ListTable\";\nimport { Row, Col } from 'react-grid-system';\n\nfunction PoolList({ user }: {user: string}) {\n  const { override } = useParams();\n  if (override) {\n    user = override;\n  }\n  const { below, above } = useViewport()\n  const [poolList, setPoolList] = useState([] as any);\n  const [selectedPool, setSelectedPool] = useState('');\n  const [totalStaked, setTotalStaked] = useState(new BigNumber(0));\n  const [opened, setOpened] = useState(false)\n\n  useEffect(() => {\n    let isCancelled = false;\n    // setPoolList([{name:\"4 UNI-V2 (WETH/COOK)\", address:\"0xf4B146FbA71F41E0592668ffbF264F1D186b2Ca8\",lockedUpPeriod:\"90 days\",rewardPerBlock:\"300\"}]);\n    async function updatePoolInfo() {\n      const poolList = await Promise.all(POOLS.map( async (pool)=>{\n        const [lockedup,reward] =\n        await Promise.all([\n            getStakeLockupDuration(pool.address),\n            getRewardPerBlock(pool.address)\n          ])\n        const poolRewardPerBlock = toTokenUnitsBN(reward, COOK.decimals);\n        return({\n          name: pool.name,\n          address: pool.address,\n          lockedUpPeriod: lockedup,\n          rewardPerBlock: poolRewardPerBlock\n        });\n      }));\n\n      const totalStakedBalance = await POOLS.reduce(async (sum, pool) => {\n        const staked = await getTotalStaked(pool.address);\n        return (await sum).plus(staked);\n      }, Promise.resolve(new BigNumber(0)));\n\n      const totalStaked = toTokenUnitsBN(totalStakedBalance, UNI.decimals);\n\n      if (!isCancelled) {\n        setPoolList(poolList);\n        setTotalStaked(totalStaked);\n      }\n    }\n    updatePoolInfo();\n\n    const id = setInterval(updatePoolInfo, 15000);\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n  return (\n    <>\n      <div style={{textAlign:\"center\"}}>\n        <div style={{fontSize:40}}>Total Staked</div>\n        <div style={{ marginBottom:8,fontSize:40, paddingRight:10}}>{totalStaked.toString()} UNI-V2</div>\n      </div>\n      <Row>\n        <Col sm={12} lg={5} >\n          <ListTable pools={poolList} selectedPool={selectedPool} setSelectedPool={(selected)=>{\n            setSelectedPool(selected)\n            setOpened(true)\n          }\n          } detailMode={true}/>\n\n        </Col>\n          <Col sm={12} lg={7}>\n          {selectedPool === '' ? '' :\n            <>\n            {above('medium') && <Pool user={user} poolAddress={selectedPool} pools={poolList}/>}\n            {below('medium') && <Modal closeButton={false} visible={opened} onClose={()=>{\n            }}><Pool user={user} poolAddress={selectedPool} pools={poolList}/>\n            <Button\n              wide\n              style={{marginTop:20}}\n              label={\"Close\"}\n              onClick={() => {\n                setOpened(false)\n              }}\n              disabled={false}\n            /></Modal>}\n\n            </>\n          }\n        </Col>\n      </Row>\n    </>\n  );\n}\n\nexport default PoolList;\n"]},"metadata":{},"sourceType":"module"}