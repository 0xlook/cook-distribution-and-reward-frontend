{"ast":null,"code":"var _jsxFileName = \"/Users/huanwen/Work/cook-frontend/src/components/Distribution/index.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport BigNumber from 'bignumber.js';\nimport { getDistributionVestingAmount, getDistributionVestedAmount, getDistributionAvalibleAmount, getDistributionStartTimestamp, getTodayNumber, getTokenAllowance, getTokenBalance, getStakeLockupDuration, getRewardPerBlock, getTotalStaked, getPoolBalanceOfStaked } from '../../utils/infura';\nimport { getWithdrawRecords } from '../../utils/web3';\nimport { COOK, UNI, WETH } from \"../../constants/tokens\";\nimport { CookDistribution, POOLS } from \"../../constants/contracts\";\nimport { toTokenUnitsBN } from '../../utils/number';\nimport WithdrawPageHeader from \"./Header\";\nimport Withdraw from \"./Withdraw\";\nimport Zap from \"./Zap\";\nimport { Col } from 'react-grid-system';\nimport { BalanceBlock } from '../common/index';\n\nfunction Distribution({\n  user\n}) {\n  const {\n    override\n  } = useParams();\n\n  if (override) {\n    user = override;\n  }\n\n  const [userWETHBalance, setUserWETHBalance] = useState(new BigNumber(0));\n  const [userWETHAllowance, setUserWETHAllowance] = useState(new BigNumber(0));\n  const [pairBalanceCOOK, setPairBalanceCOOK] = useState(new BigNumber(0));\n  const [pairBalanceWETH, setPairBalanceWETH] = useState(new BigNumber(0));\n  const [userVestingBalance, setUserVestingBalance] = useState(new BigNumber(0));\n  const [userVestedBalance, setUserVestedBalance] = useState(new BigNumber(0));\n  const [userAvalibleBalance, setUserAvalibleBalance] = useState(new BigNumber(0));\n  const [startDay, setStartDay] = useState(new BigNumber(0));\n  const [today, setToday] = useState(new BigNumber(0));\n  const [withdrawRecords, setWithdrawRecords] = useState([]);\n  const [managedPools, setManagedPools] = useState([]); //Update User balances\n\n  useEffect(() => {\n    if (user === '') {\n      setUserVestingBalance(new BigNumber(0));\n      setUserVestedBalance(new BigNumber(0));\n      setUserAvalibleBalance(new BigNumber(0));\n      setPairBalanceCOOK(new BigNumber(0));\n      setPairBalanceWETH(new BigNumber(0));\n      setUserWETHBalance(new BigNumber(0));\n      setUserWETHAllowance(new BigNumber(0));\n      setStartDay(new BigNumber(0));\n      setToday(new BigNumber(0));\n      setWithdrawRecords([]);\n      setManagedPools([]);\n      return;\n    }\n\n    let isCancelled = false;\n\n    async function updateUserInfo() {\n      const [vestingBalance, vestedBalance, avalibleBalance, startTimeStamp, tDay, wRecords, pairBalanceCOOKStr, pairBalanceWETHStr, wethBalance, wethAllowance] = await Promise.all([getDistributionVestingAmount(CookDistribution, user), getDistributionVestedAmount(CookDistribution, user), getDistributionAvalibleAmount(CookDistribution, user), getDistributionStartTimestamp(CookDistribution), getTodayNumber(CookDistribution), getWithdrawRecords(CookDistribution), getTokenBalance(COOK.addr, UNI.addr), getTokenBalance(WETH.addr, UNI.addr), getTokenBalance(WETH.addr, user), getTokenAllowance(WETH.addr, user, CookDistribution)]);\n      const userVestingBalance = toTokenUnitsBN(vestingBalance, COOK.decimals);\n      const userVestedBalance = toTokenUnitsBN(vestedBalance, COOK.decimals);\n      const userAvalibleBalance = toTokenUnitsBN(avalibleBalance, COOK.decimals);\n      const startDay = new BigNumber(startTimeStamp).div(86400).decimalPlaces(0, 1);\n      const todayNumber = new BigNumber(tDay);\n      const withdrawRecords = wRecords;\n      const pairCOOKBalance = toTokenUnitsBN(pairBalanceCOOKStr, COOK.decimals);\n      const pairWETHBalance = toTokenUnitsBN(pairBalanceWETHStr, WETH.decimals);\n      const userWETHBalance = toTokenUnitsBN(wethBalance, WETH.decimals);\n      const poolList = await Promise.all(POOLS.map(async pool => {\n        const [lockedup, reward, staked, totalStaked] = await Promise.all([getStakeLockupDuration(pool.address), getRewardPerBlock(pool.address), getTotalStaked(pool.address), getPoolBalanceOfStaked(pool.address, user)]);\n        const totalStakedBalance = toTokenUnitsBN(totalStaked, UNI.decimals);\n        const userTotalStakedBalance = toTokenUnitsBN(staked, UNI.decimals);\n        const poolRewardPerBlock = toTokenUnitsBN(reward, COOK.decimals);\n        return {\n          pool: pool.address,\n          lockedUp: lockedup,\n          reward: poolRewardPerBlock,\n          staked: userTotalStakedBalance,\n          totalStaked: totalStakedBalance\n        };\n      }));\n\n      if (!isCancelled) {\n        setUserVestingBalance(new BigNumber(userVestingBalance));\n        setUserVestedBalance(new BigNumber(userVestedBalance));\n        setUserAvalibleBalance(new BigNumber(userAvalibleBalance));\n        setStartDay(new BigNumber(startDay));\n        setToday(new BigNumber(todayNumber));\n        setWithdrawRecords(withdrawRecords);\n        setPairBalanceCOOK(new BigNumber(pairCOOKBalance));\n        setPairBalanceWETH(new BigNumber(pairWETHBalance));\n        setUserWETHBalance(new BigNumber(userWETHBalance));\n        setManagedPools(poolList);\n        setUserWETHAllowance(new BigNumber(wethAllowance));\n      }\n    }\n\n    updateUserInfo();\n    const id = setInterval(updateUserInfo, 1000); // eslint-disable-next-line consistent-return\n\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      textAlign: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      fontWeight: 'bold',\n      fontSize: 40\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, \"Cook Protocol\"), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: 30,\n      marginBottom: 50,\n      fontSize: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }\n  }, \"Mobri.........\"), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      fontWeight: 'bold',\n      fontSize: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 7\n    }\n  }, \"Total Token 10,000,000 COOK\")), /*#__PURE__*/React.createElement(WithdrawPageHeader, {\n    accountVestingBalance: userVestingBalance,\n    accountAvalibleBalance: userAvalibleBalance,\n    accountVestedBalance: userVestedBalance,\n    todayNumber: today,\n    startDayNumber: startDay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      padding: \"2%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Withdraw, {\n    user: user,\n    vestingAmount: userVestingBalance,\n    availableAmount: userAvalibleBalance,\n    records: withdrawRecords,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Zap, {\n    component: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Col, {\n      xs: 12,\n      md: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(BalanceBlock, {\n      asset: \"Available COOK\",\n      balance: userAvalibleBalance,\n      suffix: \"COOK\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      xs: 12,\n      md: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(BalanceBlock, {\n      asset: \"WETH Balance\",\n      balance: userWETHBalance,\n      suffix: \"WETH\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 11\n      }\n    }))),\n    user: user,\n    pools: managedPools,\n    cookAvailable: userAvalibleBalance,\n    wethBalance: userWETHBalance,\n    wethAllowance: userWETHAllowance,\n    pairBalanceWETH: pairBalanceWETH,\n    pairBalanceCOOK: pairBalanceCOOK,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }\n  })));\n}\n\nexport default Distribution;","map":{"version":3,"sources":["/Users/huanwen/Work/cook-frontend/src/components/Distribution/index.tsx"],"names":["React","useState","useEffect","useParams","BigNumber","getDistributionVestingAmount","getDistributionVestedAmount","getDistributionAvalibleAmount","getDistributionStartTimestamp","getTodayNumber","getTokenAllowance","getTokenBalance","getStakeLockupDuration","getRewardPerBlock","getTotalStaked","getPoolBalanceOfStaked","getWithdrawRecords","COOK","UNI","WETH","CookDistribution","POOLS","toTokenUnitsBN","WithdrawPageHeader","Withdraw","Zap","Col","BalanceBlock","Distribution","user","override","userWETHBalance","setUserWETHBalance","userWETHAllowance","setUserWETHAllowance","pairBalanceCOOK","setPairBalanceCOOK","pairBalanceWETH","setPairBalanceWETH","userVestingBalance","setUserVestingBalance","userVestedBalance","setUserVestedBalance","userAvalibleBalance","setUserAvalibleBalance","startDay","setStartDay","today","setToday","withdrawRecords","setWithdrawRecords","managedPools","setManagedPools","isCancelled","updateUserInfo","vestingBalance","vestedBalance","avalibleBalance","startTimeStamp","tDay","wRecords","pairBalanceCOOKStr","pairBalanceWETHStr","wethBalance","wethAllowance","Promise","all","addr","decimals","div","decimalPlaces","todayNumber","pairCOOKBalance","pairWETHBalance","poolList","map","pool","lockedup","reward","staked","totalStaked","address","totalStakedBalance","userTotalStakedBalance","poolRewardPerBlock","lockedUp","id","setInterval","clearInterval","textAlign","fontWeight","fontSize","marginTop","marginBottom","padding"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\n\nimport BigNumber from 'bignumber.js';\nimport {getDistributionVestingAmount,\n        getDistributionVestedAmount,\n        getDistributionAvalibleAmount,\n        getDistributionStartTimestamp,\n        getTodayNumber,\n        getTokenAllowance,\n        getTokenBalance,\n        getStakeLockupDuration,\n        getRewardPerBlock,\n        getTotalStaked,\n        getPoolBalanceOfStaked} from '../../utils/infura';\nimport {getWithdrawRecords} from '../../utils/web3';\nimport {COOK, UNI, WETH} from \"../../constants/tokens\";\nimport {CookDistribution, POOLS} from \"../../constants/contracts\";\nimport { toTokenUnitsBN } from '../../utils/number';\nimport WithdrawPageHeader from \"./Header\";\nimport Withdraw from \"./Withdraw\";\nimport Zap from \"./Zap\";\nimport { Container, Row, Col } from 'react-grid-system';\nimport {\n  BalanceBlock\n} from '../common/index';\n\nfunction Distribution({ user }: {user: string}) {\n  const { override } = useParams();\n  if (override) {\n    user = override;\n  }\n\n  const [userWETHBalance, setUserWETHBalance] = useState(new BigNumber(0));\n  const [userWETHAllowance, setUserWETHAllowance] = useState(new BigNumber(0));\n\n  const [pairBalanceCOOK, setPairBalanceCOOK] = useState(new BigNumber(0));\n  const [pairBalanceWETH, setPairBalanceWETH] = useState(new BigNumber(0));\n\n\n  const [userVestingBalance, setUserVestingBalance] = useState(new BigNumber(0));\n  const [userVestedBalance, setUserVestedBalance] = useState(new BigNumber(0));\n  const [userAvalibleBalance, setUserAvalibleBalance] = useState(new BigNumber(0));\n\n  const [startDay, setStartDay] = useState(new BigNumber(0));\n  const [today, setToday] = useState(new BigNumber(0));\n  const [withdrawRecords, setWithdrawRecords] = useState([]);\n  const [managedPools, setManagedPools] = useState([] as any);\n\n\n  //Update User balances\n  useEffect(() => {\n    if (user === '') {\n      setUserVestingBalance(new BigNumber(0));\n      setUserVestedBalance(new BigNumber(0));\n      setUserAvalibleBalance(new BigNumber(0));\n      setPairBalanceCOOK(new BigNumber(0));\n      setPairBalanceWETH(new BigNumber(0));\n      setUserWETHBalance(new BigNumber(0));\n      setUserWETHAllowance(new BigNumber(0));\n      setStartDay(new BigNumber(0));\n      setToday(new BigNumber(0));\n      setWithdrawRecords([]);\n      setManagedPools([]);\n      return;\n    }\n    let isCancelled = false;\n\n    async function updateUserInfo() {\n      const [vestingBalance,\n             vestedBalance,\n             avalibleBalance,\n             startTimeStamp,\n             tDay,\n             wRecords,\n             pairBalanceCOOKStr,\n             pairBalanceWETHStr,\n             wethBalance,\n             wethAllowance\n           ] = await Promise.all([\n        getDistributionVestingAmount(CookDistribution, user),\n        getDistributionVestedAmount(CookDistribution, user),\n        getDistributionAvalibleAmount(CookDistribution, user),\n        getDistributionStartTimestamp(CookDistribution),\n        getTodayNumber(CookDistribution),\n        getWithdrawRecords(CookDistribution),\n        getTokenBalance(COOK.addr, UNI.addr),\n        getTokenBalance(WETH.addr, UNI.addr),\n        getTokenBalance(WETH.addr, user),\n        getTokenAllowance(WETH.addr, user, CookDistribution)\n      ]);\n\n      const userVestingBalance = toTokenUnitsBN(vestingBalance, COOK.decimals);\n      const userVestedBalance = toTokenUnitsBN(vestedBalance, COOK.decimals);\n      const userAvalibleBalance = toTokenUnitsBN(avalibleBalance, COOK.decimals);\n      const startDay = new BigNumber(startTimeStamp).div(86400).decimalPlaces(0, 1);\n      const todayNumber = new BigNumber(tDay);\n      const withdrawRecords = wRecords;\n\n      const pairCOOKBalance = toTokenUnitsBN(pairBalanceCOOKStr, COOK.decimals);\n      const pairWETHBalance = toTokenUnitsBN(pairBalanceWETHStr, WETH.decimals);\n      const userWETHBalance = toTokenUnitsBN(wethBalance, WETH.decimals);\n\n\n      const poolList = await Promise.all(POOLS.map( async (pool)=>{\n        const [lockedup,reward,staked,totalStaked] =\n        await Promise.all([\n            getStakeLockupDuration(pool.address),\n            getRewardPerBlock(pool.address),\n            getTotalStaked(pool.address),\n            getPoolBalanceOfStaked(pool.address,user)\n          ])\n\n        const totalStakedBalance = toTokenUnitsBN(totalStaked, UNI.decimals);\n        const userTotalStakedBalance = toTokenUnitsBN(staked, UNI.decimals);\n        const poolRewardPerBlock = toTokenUnitsBN(reward, COOK.decimals);\n\n\n        return({pool:pool.address,lockedUp:lockedup,reward:poolRewardPerBlock,staked:userTotalStakedBalance,totalStaked:totalStakedBalance})\n      }))\n\n      if (!isCancelled) {\n        setUserVestingBalance(new BigNumber(userVestingBalance));\n        setUserVestedBalance(new BigNumber(userVestedBalance));\n        setUserAvalibleBalance(new BigNumber(userAvalibleBalance));\n        setStartDay(new BigNumber(startDay));\n        setToday(new BigNumber(todayNumber));\n        setWithdrawRecords(withdrawRecords);\n\n        setPairBalanceCOOK(new BigNumber(pairCOOKBalance));\n        setPairBalanceWETH(new BigNumber(pairWETHBalance));\n        setUserWETHBalance(new BigNumber(userWETHBalance));\n        setManagedPools(poolList)\n        setUserWETHAllowance(new BigNumber(wethAllowance));\n      }\n    }\n    updateUserInfo();\n    const id = setInterval(updateUserInfo, 1000);\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n\n  return (\n    <>\n      <div style={{textAlign:\"center\"}}>\n      <div style={{fontWeight:'bold', fontSize:40}}>Cook Protocol</div>\n      <div style={{marginTop:30, marginBottom:50,fontSize:20}}>{\"Mobri.........\"}</div>\n      <div style={{fontWeight:'bold', fontSize:35}}>Total Token 10,000,000 COOK</div>\n      </div>\n      <WithdrawPageHeader\n        accountVestingBalance={userVestingBalance}\n        accountAvalibleBalance={userAvalibleBalance}\n        accountVestedBalance={userVestedBalance}\n        todayNumber={today}\n        startDayNumber={startDay}\n      />\n      <div style={{padding:\"2%\"}}>\n      <Withdraw\n        user={user}\n        vestingAmount={userVestingBalance}\n        availableAmount={userAvalibleBalance}\n        records={withdrawRecords}\n      />\n\n\n      <Zap\n        component={\n          <>\n          <Col xs={12} md={4}>\n            <BalanceBlock asset=\"Available COOK\" balance={userAvalibleBalance} suffix={\"COOK\"} />\n          </Col>\n          <Col xs={12} md={4}>\n          <BalanceBlock asset=\"WETH Balance\" balance={userWETHBalance} suffix={\"WETH\"} />\n          </Col></>}\n        user={user}\n        pools={managedPools}\n        cookAvailable={userAvalibleBalance}\n        wethBalance={userWETHBalance}\n        wethAllowance={userWETHAllowance}\n        pairBalanceWETH={pairBalanceWETH}\n        pairBalanceCOOK={pairBalanceCOOK}\n      />\n      </div>\n    </>\n  );\n}\n\nexport default Distribution;\n"]},"metadata":{},"sourceType":"module"}